## 商品管理模块代码注释

### AdminGoodsController.java

```java
/**
 * 商品管理控制器类
 * 
 * 职责：
 * - 处理商品相关的HTTP请求
 * - 参数验证和权限控制
 * - 调用服务层处理业务逻辑
 * - 返回统一的HTTP响应
 * 
 * 设计模式：
 * - 使用Spring MVC的REST控制器模式
 * - 依赖注入模式管理服务层依赖
 * 
 * @author litemall开发团队
 * @version 1.0
 * @since 2023-01-01
 */
@RestController
@RequestMapping("/admin/goods")
@Validated
public class AdminGoodsController {
    
    /**
     * 商品管理服务层依赖注入
     * 通过Spring的依赖注入机制自动装配服务层实例
     */
    @Autowired
    private AdminGoodsService adminGoodsService;
    
    /**
     * 查询商品列表
     * 
     * HTTP方法：GET
     * 路径：/admin/goods/list
     * 
     * 业务逻辑：
     * - 支持多条件查询（商品编号、商品名称、分类ID等）
     * - 支持分页查询
     * - 返回商品基本信息列表
     * 
     * @param goodsSn 商品编号（可选，模糊匹配）
     * @param name 商品名称（可选，模糊匹配）
     * @param categoryId 分类ID（可选，精确匹配）
     * @param brandId 品牌ID（可选，精确匹配）
     * @param page 页码（可选，默认1）
     * @param limit 每页数量（可选，默认10）
     * @param sort 排序字段（可选）
     * @param order 排序方向（可选，asc/desc）
     * 
     * @return 商品列表响应对象，包含分页信息和商品数据
     * 
     * 示例请求：
     * GET /admin/goods/list?name=手机&categoryId=1&page=1&limit=10
     * 
     * 响应格式：
     * {
     *   "errno": 0,
     *   "data": {
     *     "total": 100,
     *     "pages": 10,
     *     "limit": 10,
     *     "page": 1,
     *     "list": [商品对象数组]
     *   },
     *   "errmsg": "成功"
     * }
     */
    @GetMapping("/list")
    public Object list(String goodsSn, String name, Integer categoryId, 
                      Integer brandId, @RequestParam(defaultValue = "1") Integer page,
                      @RequestParam(defaultValue = "10") Integer limit,
                      @Sort @RequestParam(defaultValue = "add_time") String sort,
                      @Order @RequestParam(defaultValue = "desc") String order) {
        // 调用服务层处理查询逻辑
        return adminGoodsService.list(goodsSn, name, categoryId, brandId, page, limit, sort, order);
    }
    
    /**
     * 创建商品
     * 
     * HTTP方法：POST
     * 路径：/admin/goods/create
     * 
     * 业务逻辑：
     * - 接收完整的商品信息（基本信息、规格、属性、货品）
     * - 数据验证和业务规则检查
     * - 开启事务处理多表插入
     * - 返回创建结果
     * 
     * @param goodsAllinone 商品完整信息对象
     *                     包含商品基本信息、规格列表、属性列表、货品列表
     * 
     * @return 创建结果响应对象
     * 
     * 事务管理：
     * - 方法内部开启数据库事务
     * - 任何异常都会导致事务回滚
     * - 确保数据一致性
     * 
     * 数据验证：
     * - 商品名称不能为空
     * - 商品编号必须唯一
     * - 价格必须大于0
     * - 库存不能为负数
     */
    @PostMapping("/create")
    public Object create(@RequestBody GoodsAllinone goodsAllinone) {
        // 调用服务层处理商品创建逻辑
        // 服务层会进行数据验证和事务管理
        return adminGoodsService.create(goodsAllinone);
    }
    
    /**
     * 更新商品信息
     * 
     * HTTP方法：POST
     * 路径：/admin/goods/update
     * 
     * 业务逻辑：
     * - 根据商品ID更新商品信息
     * - 支持部分字段更新
     * - 更新相关规格、属性、货品信息
     * 
     * @param goodsAllinone 商品完整信息对象
     * 
     * @return 更新结果响应对象
     * 
     * 注意：
     * - 商品ID必须存在
     * - 更新操作会覆盖原有数据
     * - 需要重新验证业务规则
     */
    @PostMapping("/update")
    public Object update(@RequestBody GoodsAllinone goodsAllinone) {
        return adminGoodsService.update(goodsAllinone);
    }
    
    /**
     * 删除商品
     * 
     * HTTP方法：POST
     * 路径：/admin/goods/delete
     * 
     * 业务逻辑：
     * - 根据商品ID删除商品
     * - 级联删除相关规格、属性、货品信息
     * - 检查商品是否被订单引用
     * 
     * @param goods 商品基本信息对象，至少包含商品ID
     * 
     * @return 删除结果响应对象
     * 
     * 安全考虑：
     * - 删除前检查商品是否可删除
     * - 记录删除操作日志
     * - 提供软删除选项（可选）
     */
    @PostMapping("/delete")
    public Object delete(@RequestBody LitemallGoods goods) {
        return adminGoodsService.delete(goods);
    }
    
    /**
     * 查询商品详情
     * 
     * HTTP方法：GET
     * 路径：/admin/goods/detail
     * 
     * 业务逻辑：
     * - 根据商品ID查询完整商品信息
     * - 包含基本信息、规格、属性、货品
     * - 支持缓存优化
     * 
     * @param id 商品ID（必填）
     * 
     * @return 商品详情响应对象
     * 
     * 性能优化：
     * - 使用缓存减少数据库查询
     * - 懒加载关联数据
     * - 分页查询大量数据
     */
    @GetMapping("/detail")
    public Object detail(Integer id) {
        return adminGoodsService.detail(id);
    }
}
```

### AdminGoodsService.java

```java
/**
 * 商品管理服务类
 * 
 * 职责：
 * - 实现商品相关的业务逻辑
 * - 数据验证和业务规则检查
 * - 事务管理和数据一致性保证
 * - 调用数据访问层进行数据库操作
 * 
 * 设计特点：
 * - 使用Spring的@Service注解标识服务层组件
 * - 通过@Transactional管理数据库事务
 * - 依赖注入数据访问层组件
 * 
 * 业务规则：
 * - 商品创建时的数据验证规则
 * - 商品更新的业务约束
 * - 商品删除的级联处理
 */
@Service
public class AdminGoodsService {
    
    /**
     * 商品基本信息数据访问对象
     * 用于操作litemall_goods表
     */
    @Autowired
    private LitemallGoodsMapper goodsMapper;
    
    /**
     * 商品规格数据访问对象
     * 用于操作litemall_goods_specification表
     */
    @Autowired
    private LitemallGoodsSpecificationMapper goodsSpecificationMapper;
    
    /**
     * 商品属性数据访问对象
     * 用于操作litemall_goods_attribute表
     */
    @Autowired
    private LitemallGoodsAttributeMapper goodsAttributeMapper;
    
    /**
     * 商品货品数据访问对象
     * 用于操作litemall_goods_product表
     */
    @Autowired
    private LitemallGoodsProductMapper goodsProductMapper;
    
    /**
     * 创建商品完整信息
     * 
     * 业务逻辑流程：
     * 1. 数据验证 → 2. 开启事务 → 3. 保存商品基本信息 → 
     * 4. 处理规格信息 → 5. 处理属性信息 → 6. 处理货品信息 → 
     * 7. 提交事务 → 8. 更新缓存
     * 
     * @param goodsAllinone 商品完整信息对象
     * 
     * @return 创建结果
     * 
     * @throws IllegalArgumentException 当数据验证失败时抛出
     * @throws RuntimeException 当数据库操作失败时抛出
     * 
     * 事务说明：
     * - 方法级别事务，传播行为为REQUIRED
     * - 隔离级别为READ_COMMITTED
     * - 超时时间为30秒
     * - 遇到RuntimeException时回滚事务
     */
    @Transactional
    public Object create(GoodsAllinone goodsAllinone) {
        // 数据验证
        validate(goodsAllinone);
        
        // 获取商品基本信息
        LitemallGoods goods = goodsAllinone.getGoods();
        
        // 设置默认值
        if (goods.getAddTime() == null) {
            goods.setAddTime(LocalDateTime.now());
        }
        
        // 保存商品基本信息
        goodsMapper.insertSelective(goods);
        
        // 处理商品规格信息
        List<LitemallGoodsSpecification> specifications = goodsAllinone.getSpecifications();
        if (specifications != null && !specifications.isEmpty()) {
            for (LitemallGoodsSpecification specification : specifications) {
                specification.setGoodsId(goods.getId());
                specification.setAddTime(LocalDateTime.now());
                goodsSpecificationMapper.insertSelective(specification);
            }
        }
        
        // 处理商品属性信息
        List<LitemallGoodsAttribute> attributes = goodsAllinone.getAttributes();
        if (attributes != null && !attributes.isEmpty()) {
            for (LitemallGoodsAttribute attribute : attributes) {
                attribute.setGoodsId(goods.getId());
                attribute.setAddTime(LocalDateTime.now());
                goodsAttributeMapper.insertSelective(attribute);
            }
        }
        
        // 处理商品货品信息
        List<LitemallGoodsProduct> products = goodsAllinone.getProducts();
        if (products != null && !products.isEmpty()) {
            for (LitemallGoodsProduct product : products) {
                product.setGoodsId(goods.getId());
                product.setAddTime(LocalDateTime.now());
                goodsProductMapper.insertSelective(product);
            }
        }
        
        return ResponseUtil.ok();
    }
    
    /**
     * 商品数据验证
     * 
     * 验证规则：
     * - 商品名称不能为空且长度限制
     * - 商品编号必须唯一
     * - 价格必须大于0
     * - 库存不能为负数
     * - 分类ID必须存在
     * - 品牌ID必须存在（如果提供）
     * 
     * @param goodsAllinone 待验证的商品信息
     * 
     * @throws IllegalArgumentException 当验证失败时抛出，包含具体的错误信息
     */
    private void validate(GoodsAllinone goodsAllinone) {
        LitemallGoods goods = goodsAllinone.getGoods();
        
        // 验证商品名称
        if (StringUtils.isEmpty(goods.getName())) {
            throw new IllegalArgumentException("商品名称不能为空");
        }
        if (goods.getName().length() > 100) {
            throw new IllegalArgumentException("商品名称长度不能超过100个字符");
        }
        
        // 验证商品编号唯一性
        if (!StringUtils.isEmpty(goods.getGoodsSn())) {
            LitemallGoodsExample example = new LitemallGoodsExample();
            example.createCriteria().andGoodsSnEqualTo(goods.getGoodsSn());
            long count = goodsMapper.countByExample(example);
            if (count > 0) {
                throw new IllegalArgumentException("商品编号已存在");
            }
        }
        
        // 验证价格
        if (goods.getCounterPrice() != null && goods.getCounterPrice().compareTo(BigDecimal.ZERO) < 0) {
            throw new IllegalArgumentException("专柜价格不能为负数");
        }
        if (goods.getRetailPrice() != null && goods.getRetailPrice().compareTo(BigDecimal.ZERO) <= 0) {
            throw new IllegalArgumentException("零售价格必须大于0");
        }
        
        // 验证库存
        if (goods.getGoodsNumber() != null && goods.getGoodsNumber() < 0) {
            throw new IllegalArgumentException("商品库存不能为负数");
        }
    }
    
    /**
     * 查询商品列表（带分页）
     * 
     * 查询逻辑：
     * - 支持多条件组合查询
     * - 支持分页和排序
     * - 返回格式化后的分页数据
     * 
     * @param goodsSn 商品编号（模糊匹配）
     * @param name 商品名称（模糊匹配）
     * @param categoryId 分类ID（精确匹配）
     * @param brandId 品牌ID（精确匹配）
     * @param page 页码
     * @param limit 每页数量
     * @param sort 排序字段
     * @param order 排序方向
     * 
     * @return 分页查询结果
     * 
     * 性能考虑：
     * - 使用索引优化查询性能
     * - 避免N+1查询问题
     * - 限制最大查询数量
     */
    public Object list(String goodsSn, String name, Integer categoryId, 
                      Integer brandId, Integer page, Integer limit, 
                      String sort, String order) {
        
        // 构建查询条件
        LitemallGoodsExample example = new LitemallGoodsExample();
        LitemallGoodsExample.Criteria criteria = example.createCriteria();
        
        if (!StringUtils.isEmpty(goodsSn)) {
            criteria.andGoodsSnLike("%" + goodsSn + "%");
        }
        if (!StringUtils.isEmpty(name)) {
            criteria.andNameLike("%" + name + "%");
        }
        if (categoryId != null) {
            criteria.andCategoryIdEqualTo(categoryId);
        }
        if (brandId != null) {
            criteria.andBrandIdEqualTo(brandId);
        }
        criteria.andDeletedEqualTo(false);
        
        // 设置排序
        if (!StringUtils.isEmpty(sort) && !StringUtils.isEmpty(order)) {
            example.setOrderByClause(sort + " " + order);
        }
        
        // 执行分页查询
        PageHelper.startPage(page, limit);
        List<LitemallGoods> goodsList = goodsMapper.selectByExample(example);
        PageInfo<LitemallGoods> pageInfo = new PageInfo<>(goodsList);
        
        // 构建响应数据
        Map<String, Object> data = new HashMap<>();
        data.put("total", pageInfo.getTotal());
        data.put("items", goodsList);
        
        return ResponseUtil.ok(data);
    }
}
```

### GoodsAllinone.java

```java
/**
 * 商品完整信息数据传输对象
 * 
 * 设计目的：
 * - 聚合商品相关的所有数据
 * - 简化前后端数据交换
 * - 提供统一的数据验证接口
 * 
 * 包含数据：
 * - 商品基本信息（LitemallGoods）
 * - 商品规格列表（List<LitemallGoodsSpecification>）
 * - 商品属性列表（List<LitemallGoodsAttribute>）
 * - 商品货品列表（List<LitemallGoodsProduct>）
 * 
 * 使用场景：
 * - 商品创建时的数据接收
 * - 商品更新时的数据传递
 * - 商品详情查询时的数据返回
 */
public class GoodsAllinone {
    
    /**
     * 商品基本信息
     * 对应数据库表：litemall_goods
     * 
     * 包含字段：
     * - id: 商品ID（主键）
     * - name: 商品名称
     * - goodsSn: 商品编号
     * - categoryId: 分类ID
     * - brandId: 品牌ID
     * - gallery: 商品宣传图片列表
     * - keywords: 商品关键字
     * - brief: 商品简介
     * - isOnSale: 是否上架
     * - sortOrder: 排序值
     * - picUrl: 商品页面商品图片
     * - shareUrl: 商品分享海报
     * - isNew: 是否新品
     * - isHot: 是否热卖
     * - unit: 商品单位
     * - counterPrice: 专柜价格
     * - retailPrice: 零售价格
     * - detail: 商品详细介绍
     */
    private LitemallGoods goods;
    
    /**
     * 商品规格列表
     * 对应数据库表：litemall_goods_specification
     * 
     * 规格定义：
     * - 如颜色、尺寸、版本等
     * - 每个规格包含规格名称和规格值
     * - 用于生成商品SKU
     */
    private List<LitemallGoodsSpecification> specifications;
    
    /**
     * 商品属性列表
     * 对应数据库表：litemall_goods_attribute
     * 
     * 属性定义：
     * - 如材质、重量、产地等
     * - 用于商品详情展示
     * - 不参与SKU生成
     */
    private List<LitemallGoodsAttribute> attributes;
    
    /**
     * 商品货品列表
     * 对应数据库表：litemall_goods_product
     * 
     * 货品定义：
     * - 具体的商品SKU
     * - 包含规格组合、价格、库存等信息
     * - 用于库存管理和订单处理
     */
    private List<LitemallGoodsProduct> products;
    
    // Getter和Setter方法
    // 省略具体实现...
}
```