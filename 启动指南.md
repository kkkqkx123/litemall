# litemall 项目启动指南

## 项目概述

litemall 是一个开源的小商城系统，采用前后端分离架构，包含：
- **后端服务**：基于 Spring Boot 3.5.6 开发
- **管理后台前端**：基于 Vue.js + Element UI 开发
- **微信小程序前端**：基于微信小程序原生框架开发

## 环境要求

- **Java**: JDK 21 或更高版本
- **Maven**: 3.6+  
- **MySQL**: 8.0+（通过 Docker 运行）
- **Node.js**: 14+（前端开发）

## 数据库配置

项目使用 Docker 运行 MySQL 数据库：

```bash
# 检查 MySQL 容器状态
docker ps

# 测试数据库连接
docker exec mysql mysql -uroot -proot -e "SHOW DATABASES;"
```

数据库连接信息：
- **主机**: localhost:3306
- **数据库**: litemall
- **用户名**: root
- **密码**: root

## 后端服务启动方式

### 方式一：使用 Maven Spring Boot 插件启动（开发环境推荐）

```bash
# 进入后端模块目录
cd litemall-all

# 使用 Maven 启动（需要显式指定 Spring Profile）
mvn spring-boot:run -Dspring-boot.run.arguments="--spring.profiles.active=db,core,admin,wx"
```

**注意**：由于 Spring Boot 配置加载机制，必须显式指定 Spring Profile 参数。

### 方式二：使用可执行 JAR 文件启动（生产环境推荐）

```bash
# 1. 首先构建项目
cd litemall
mvn clean package -DskipTests

# 2. 进入后端模块目录
cd litemall-all

# 3. 使用 JAR 文件启动（必须指定 Spring Profile）
java -jar target/litemall-all-0.1.0-exec.jar --spring.profiles.active=db,core,admin,wx
```

### Spring Profile 配置说明

项目采用模块化配置设计，通过 Spring Profile 实现配置分离：

| Profile | 配置文件 | 功能说明 |
|---------|----------|----------|
| `db` | `application-db.yml` | 数据库配置（MySQL 连接、连接池等） |
| `core` | `application-core.yml` | 核心业务配置（微信、通知、邮件等） |
| `admin` | `application-admin.yml` | 管理后台配置（权限、JWT、日志等） |
| `wx` | `application-wx.yml` | 微信小程序配置（业务参数、支付等） |

**重要**：启动时必须同时激活所有四个 Profile，否则服务无法正常启动。

## 启动验证

### 后端服务验证

服务启动成功后，控制台会显示：
```
Tomcat started on port 8080 (http) with context path '/'
Started Application in X seconds
```

### API 接口测试

使用 curl 命令测试服务是否正常：

```bash
# 获取 JWT Token
curl -X POST "http://localhost:8080/admin/auth/login" \
     -H "Content-Type: application/json" \
     -d '{"username":"admin123","password":"admin123"}'

# 使用 Token 访问 API（替换 YOUR_TOKEN）
curl -X GET "http://localhost:8080/admin/stat/order/enhanced?month=1" \
     -H "Content-Type: application/json" \
     -H "Authorization: Bearer YOUR_TOKEN"
```

## 常见问题解决

### 1. 数据库连接失败
```
Failed to configure a DataSource: 'url' attribute is not specified
```
**解决方案**：确保 MySQL 容器正在运行，并且正确指定了 Spring Profile。

### 2. Spring Profile 未激活
```
No active profile set, falling back to 1 default profile: "default"
```
**解决方案**：启动时显式指定 `--spring.profiles.active=db,core,admin,wx` 参数。

### 3. JAR 文件无法启动
```
target/litemall-all-0.1.0.jar中没有主清单属性
```
**解决方案**：使用 `litemall-all-0.1.0-exec.jar` 而不是普通 JAR 文件。

## 前端服务启动

### 管理后台前端
```bash
# 进入前端目录
cd litemall-admin

# 安装依赖
npm install

# 启动开发服务器
npm run dev
```

### 微信小程序
- 使用微信开发者工具打开 `litemall-wx` 目录
- 配置小程序 AppID
- 编译并预览

## 日志查看

后端服务日志位于：`litemall-all/logs/log.log`

## 项目架构

```
litemall/
├── litemall-all/          # 后端主模块（打包模块）
│   └── src/main/resources/
│       ├── application.yml          # 主配置文件
│       ├── application-db.yml       # 数据库配置
│       ├── application-core.yml     # 核心业务配置
│       ├── application-admin.yml    # 管理后台配置
│       └── application-wx.yml       # 微信小程序配置
├── litemall-admin/        # 管理后台前端
├── litemall-wx/          # 微信小程序前端
└── litemall-vue/         # 轻商城前端
```

## 总结

当前项目的配置实现是正确的，通过 Spring Profile 实现了模块化配置分离。启动时需要注意：

1. **必须显式指定 Spring Profile**：`--spring.profiles.active=db,core,admin,wx`
2. **数据库必须正常运行**：确保 MySQL Docker 容器已启动
3. **使用正确的 JAR 文件**：生产环境使用 `*-exec.jar` 文件

这种配置架构既保证了配置的集中管理，又实现了功能的模块化分离，符合 Spring Boot 应用的最佳实践。