# 基础配置 - 所有环境共享的配置
spring:
  profiles:
    active: ${SPRING_PROFILES_ACTIVE:default}  # 通过环境变量设置，默认为default
  messages:
    encoding: UTF-8
  servlet:
    multipart:
      max-file-size: 20MB
      max-request-size: 20MB
  datasource:
    druid:
      driver-class-name: com.mysql.cj.jdbc.Driver
      pool-prepared-statements: true
      max-pool-prepared-statement-per-connection-size: 20
      validation-query: SELECT 1 FROM DUAL
      test-on-borrow: false
      test-on-return: false
      test-while-idle: true
      time-between-eviction-runs-millis: 60000
      webStatFilter:
        enabled: true
  security:
    basic:
      enabled: false

# PageHelper分页插件配置（所有环境共享）
pagehelper:
  helperDialect: mysql
  reasonable: true
  supportMethodsArguments: true
  params: count=countSql

# JWT配置（所有环境共享）
app:
  jwt:
    # 管理后台JWT配置
    secret: ${JWT_SECRET:APZvEuDRA9S2j2m9bpBKPPEiCbSRChKayBYEDc4RIK8=}
    expiration: 86400000 # 24小时
    header: Authorization
    prefix: Bearer
    # 小程序JWT配置
    wx:
      secret: ${WX_JWT_SECRET:APZvEuDRA9S2j2m9bpBKPPEiCbSRChKayBYEDc4RIK8=}
      expiration: 7200000 # 2小时
      issuer: LITEMALL
      subject: this is litemall token
      audience: MINIAPP

# 微信小程序配置（基础配置）
litemall:
  wx:
    app-id: ${WX_APP_ID:wxa5b486c6b918ecfb}
    app-secret: ${WX_APP_SECRET:e04004829d4c383b4db7769d88dfbca1}
    mch-id: ${WX_MCH_ID:111111}
    mch-key: ${WX_MCH_KEY:xxxxxx}
    notify-url: ${WX_NOTIFY_URL:http://www.example.com/wx/order/pay-notify}
    # 商户证书文件路径
    key-path: ${WX_KEY_PATH:xxxxx}
    # 消息推送配置token
    token: ${WX_TOKEN:}
    # 消息推送配置AesKey
    aes-key: ${WX_AES_KEY:}

  # 管理后台配置
  admin:
    # 管理员相关配置
    avatar: https://wpimg.wallstcn.com/f778738c-e4f8-4870-b634-56703b4acafe.gif

  # 通知相关配置（基础模板）
  notify:
    mail:
      # 邮件通知配置
      host: ${MAIL_HOST:smtp.exmail.qq.com}
      username: ${MAIL_USERNAME:ex@ex.com.cn}
      password: ${MAIL_PASSWORD:XXXXXXXXXXXXX}
      sendfrom: ${MAIL_SENDFROM:ex@ex.com.cn}
      sendto: ${MAIL_SENDTO:ex@qq.com}
      port: 465
    # 短消息模版通知配置
    sms:
      # 如果是腾讯云短信，则设置active的值tencent
      # 如果是阿里云短信，则设置active的值aliyun
      active: ${SMS_ACTIVE:tencent}
      sign: litemall
      template:
      - name: paySucceed
        templateId: 156349
      - name: captcha
        templateId: 156433
      - name: ship
        templateId: 158002
      - name: refund
        templateId: 159447
      tencent:
        appid: ${SMS_TENCENT_APPID:111111111}
        appkey: ${SMS_TENCENT_APPKEY:xxxxxxxxxxxxxx}
      aliyun:
        regionId: ${SMS_ALIYUN_REGION:xxx}
        accessKeyId: ${SMS_ALIYUN_AK:xxx}
        accessKeySecret: ${SMS_ALIYUN_SK:xxx}

  # 快鸟物流查询配置
  express:
    appId: ${EXPRESS_APP_ID:XXXXXXXXX}
    appKey: ${EXPRESS_APP_KEY:XXXXXXXXXXXXXXXXXXXXXXXXX}
    vendors:
    - code: "ZTO"
      name: "中通快递"
    - code: "YTO"
      name: "圆通速递"
    - code: "YD"
      name: "韵达速递"
    - code: "YZPY"
      name: "邮政快递包裹"
    - code: "EMS"
      name: "EMS"
    - code: "DBL"
      name: "德邦快递"
    - code: "FAST"
      name: "快捷快递"
    - code: "ZJS"
      name: "宅急送"
    - code: "TNT"
      name: "TNT快递"
    - code: "UPS"
      name: "UPS"
    - code: "DHL"
      name: "DHL"
    - code: "FEDEX"
      name: "FEDEX联邦(国内件)"
    - code: "FEDEX_GJ"
      name: "FEDEX联邦(国际件)"

  # 对象存储配置（基础配置）
  storage:
    # 当前工作的对象存储模式，分别是local、aliyun、tencent、qiniu
    active: ${STORAGE_ACTIVE:local}
    # 本地对象存储配置信息
    local:
      storagePath: ${STORAGE_LOCAL_PATH:storage}
      address: ${STORAGE_LOCAL_ADDRESS:http://localhost:8080/wx/storage/fetch/}
    # 阿里云对象存储配置信息
    aliyun:
      endpoint: ${STORAGE_ALIYUN_ENDPOINT:oss-cn-shenzhen.aliyuncs.com}
      accessKeyId: ${STORAGE_ALIYUN_AK:111111}
      accessKeySecret: ${STORAGE_ALIYUN_SK:xxxxxx}
      bucketName: ${STORAGE_ALIYUN_BUCKET:litemall}
    # 腾讯对象存储配置信息
    tencent:
      secretId: ${STORAGE_TENCENT_SECRET_ID:AKIDOccMr856uoU1Tsa2MQL5aqseBUWRrb5i}
      secretKey: ${STORAGE_TENCENT_SECRET_KEY:XqtgEhIdrupTs4ygaWlkUUXv3w3FiwuD}
      region: ${STORAGE_TENCENT_REGION:ap-shanghai}
      bucketName: ${STORAGE_TENCENT_BUCKET:vytech-1300096589}
    # 七牛云对象存储配置信息
    qiniu:
      endpoint: ${STORAGE_QINIU_ENDPOINT:http://pd5cb6ulu.bkt.clouddn.com}
      accessKey: ${STORAGE_QINIU_AK:111111}
      secretKey: ${STORAGE_QINIU_SK:xxxxxx}
      bucketName: ${STORAGE_QINIU_BUCKET:litemall}

  # ModelScope大模型配置（基础配置）
  modelscope:
    api-url: https://api-inference.modelscope.cn/v1/chat/completions # ModelScope API地址
    max-retries: 3  # 重试次数
    session-timeout: 30000  # 会话超时时间（毫秒）
    
    # 安全与限流配置（所有环境共享）
    security:
      # 输入验证
      validation:
        max-question-length: 500    # 最大问题长度
        max-context-length: 5000    # 最大上下文长度
        allowed-characters: "[\\u4e00-\\u9fa5\\w\\s\\d.,!?;:'\"()\\-]+"  # 允许的字符
      
      # SQL注入防护
      sql-injection:
        enabled: true
        patterns:
          - "(\\b(union|select|insert|update|delete|drop|create|alter|exec|execute)\\b)"
          - "(--|#|/\\*|\\*/|xp_)"
      
      # 限流配置
      rate-limiting:
        enabled: true
        # 基于IP的限流
        ip-based:
          requests-per-minute: 60
          burst-size: 10
        # 基于用户的限流
        user-based:
          requests-per-minute: 100
          burst-size: 20
    
    # 监控指标配置（所有环境共享）
    metrics:
      enabled: true
      # 业务指标
      questions:
        counter: true        # 问题计数器
        timer: true          # 响应时间计时器
      # 技术指标
      llm:
        counter: true        # LLM调用计数器
        timer: true          # LLM响应时间
      database:
        counter: true        # 数据库查询计数器
        timer: true        # 数据库查询时间

# 服务器配置（基础配置）
server:
  compression:
    enabled: true
    min-response-size: 2048
    mime-types: application/javascript,text/css,application/json,application/xml,text/html,text/xml,text/plain

# 日志配置（基础配置）
logging:
  config: classpath:logback-spring.xml
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"

# 监控配置（基础配置）
management:
  endpoints:
    web:
      base-path: /actuator
  endpoint:
    health:
      show-details: always
      show-components: always
    metrics:
      enabled: true
  metrics:
    export:
      prometheus:
        enabled: true
    tags:
      application: ${spring.application.name}
      environment: ${spring.profiles.active}