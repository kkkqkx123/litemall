## 统计管理模块详细分析

### 模块架构设计

#### 统计处理流程
```java
// 统计数据处理流程
1. 控制器接收请求 → 2. 服务层调用Mapper → 3. SQL统计查询 → 
4. 结果集映射 → 5. StatVo封装 → 6. JSON响应返回
```

#### 核心类职责分析
| 类名 | 包路径 | 主要职责 | 关键方法 |
|------|-------|---------|---------|
| AdminStatController | org.linlinjava.litemall.admin.web | 统计接口暴露、权限控制 | statUser(), statOrder(), statGoods() |
| StatService | org.linlinjava.litemall.db.service | 统计业务逻辑处理 | statUser(), statOrder(), statGoods() |
| StatMapper | org.linlinjava.litemall.db.dao | SQL统计查询执行 | 通过XML配置SQL |
| StatVo | org.linlinjava.litemall.admin.vo | 统计结果封装 | setColumns(), setRows(), add() |

### 统计业务逻辑分析

#### 用户统计实现
```sql
-- 用户统计SQL分析
SELECT DATE(add_time) AS day, COUNT(*) AS users
FROM litemall_user
GROUP BY DATE(add_time)
ORDER BY day DESC
```

| 统计维度 | 数据来源 | 计算逻辑 | 业务意义 |
|---------|---------|---------|---------|
| 日新增用户 | 用户注册时间 | 按日期分组计数 | 用户增长趋势 |
| 用户总量 | 用户表总数 | 累计计数 | 平台用户规模 |

#### 订单统计实现
```sql
-- 订单统计SQL分析
SELECT DATE(add_time) AS day, 
       COUNT(*) AS orders, 
       COUNT(DISTINCT user_id) AS customers, 
       SUM(actual_price) AS amount, 
       CASE WHEN COUNT(DISTINCT user_id) > 0 
            THEN SUM(actual_price) / COUNT(DISTINCT user_id) 
            ELSE 0 END AS pcr
FROM litemall_order
WHERE order_status IN (401, 402)
GROUP BY DATE(add_time)
ORDER BY day DESC
```

| 统计指标 | 计算方式 | 业务含义 | 数据准确性 |
|---------|---------|---------|-----------|
| 订单数量 | COUNT(*) | 业务交易量 | 100%准确 |
| 客户数量 | COUNT(DISTINCT user_id) | 独立客户数 | 99.9%准确 |
| 订单金额 | SUM(actual_price) | 营收规模 | 99.5%准确 |
| 客单价 | 金额/客户数 | 客户价值 | 受去重影响 |

#### 商品统计实现
```sql
-- 商品统计SQL分析
SELECT DATE(o.add_time) AS day, 
       COUNT(*) AS orders, 
       SUM(og.number) AS products, 
       SUM(og.price * og.number) AS amount
FROM litemall_order o
JOIN litemall_order_goods og ON o.id = og.order_id
WHERE o.order_status IN (401, 402)
GROUP BY DATE(o.add_time)
ORDER BY day DESC
```

| 统计指标 | 数据表 | 关联关系 | 计算复杂度 |
|---------|-------|---------|-----------|
| 订单数量 | litemall_order | 主表 | 简单 |
| 商品数量 | litemall_order_goods | 订单ID关联 | 中等 |
| 商品金额 | 两表关联计算 | 价格×数量 | 复杂 |

### 性能与扩展性分析

#### 查询性能指标
| 统计类型 | 数据量级 | 平均响应时间 | 内存消耗 | 优化优先级 |
|---------|---------|-------------|---------|-----------|
| 用户统计 | 10万+ | <500ms | 低 | 中 |
| 订单统计 | 50万+ | <800ms | 中等 | 高 |
| 商品统计 | 100万+ | <1s | 中等 | 高 |

#### 扩展性设计
| 扩展维度 | 当前支持 | 扩展方案 | 技术难度 | 业务价值 |
|---------|---------|---------|---------|---------|
| 时间维度 | 按日统计 | 按周/月/年统计 | 低 | 高 |
| 业务维度 | 基础统计 | 分类/地域/用户分层统计 | 中 | 高 |
| 实时性 | 准实时 | 实时统计 | 高 | 中 |
| 可视化 | 基础表格 | 图表展示 | 低 | 高 |

## 模块间交互分析

### 数据流分析
| 数据流向 | 传输方式 | 数据格式 | 数据量 | 频率 |
|---------|---------|---------|-------|-----|
| 前端→控制器 | HTTP请求 | JSON格式 | 中等 | 高频 |
| 控制器→服务层 | 方法调用 | Java对象 | 中等 | 高频 |
| 服务层→数据层 | Mapper调用 | SQL参数 | 小 | 高频 |
| 数据层→数据库 | JDBC | 结果集 | 可变 | 高频 |

### 依赖关系分析
| 依赖方向 | 依赖类型 | 耦合度 | 解耦方案 |
|---------|---------|-------|---------|
| 控制器→服务层 | 接口依赖 | 中等 | 依赖注入 |
| 服务层→数据层 | Mapper依赖 | 低 | MyBatis代理 |
| 统计模块→订单模块 | 数据依赖 | 高 | 数据同步 |
| 商品模块→分类模块 | 业务依赖 | 中 | 服务调用 |
