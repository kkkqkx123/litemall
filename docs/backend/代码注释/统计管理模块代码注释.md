## 统计管理模块代码注释

### AdminStatController.java

```java
/**
 * 统计管理控制器类
 * 
 * 职责：
 * - 处理统计相关的HTTP请求
 * - 提供用户统计、订单统计、商品统计接口
 * - 返回标准化的统计结果
 * 
 * 设计特点：
 * - 每个统计维度对应一个独立的接口
 * - 统一的响应格式
 * - 简单的参数验证
 * 
 * 统计维度：
 * - 用户统计：按日统计新增用户
 * - 订单统计：按日统计订单数量、金额、客单价
 * - 商品统计：按日统计商品销售情况
 */
@RestController
@RequestMapping("/admin/stat")
public class AdminStatController {
    
    /**
     * 统计服务层依赖注入
     */
    @Autowired
    private StatService statService;
    
    /**
     * 用户统计接口
     * 
     * HTTP方法：GET
     * 路径：/admin/stat/user
     * 
     * 业务逻辑：
     * - 统计每日新增用户数量
     * - 按日期倒序排列
     * - 返回标准化的统计结果
     * 
     * @return 用户统计结果，包含日期和用户数量
     * 
     * 响应格式：
     * {
     *   "errno": 0,
     *   "data": {
     *     "columns": ["day", "users"],
     *     "rows": [
     *       {"day": "2023-01-01", "users": 10},
     *       {"day": "2023-01-02", "users": 15}
     *     ]
     *   },
     *   "errmsg": "成功"
     * }
     */
    @GetMapping("/user")
    public Object statUser() {
        return statService.statUser();
    }
    
    /**
     * 订单统计接口
     * 
     * HTTP方法：GET
     * 路径：/admin/stat/order
     * 
     * 业务逻辑：
     * - 统计每日订单数量、客户数量、订单金额、客单价
     * - 只统计已完成的订单（状态为401,402）
     * - 按日期倒序排列
     * 
     * @return 订单统计结果
     * 
     * 统计指标说明：
     * - orders: 订单数量
     * - customers: 独立客户数量
     * - amount: 订单总金额
     * - pcr: 客单价（订单金额/客户数量）
     */
    @GetMapping("/order")
    public Object statOrder() {
        return statService.statOrder();
    }
    
    /**
     * 商品统计接口
     * 
     * HTTP方法：GET
     * 路径：/admin/stat/goods
     * 
     * 业务逻辑：
     * - 统计每日商品销售情况
     * - 关联订单表和订单商品表
     * - 统计订单数量、商品数量、销售金额
     * 
     * @return 商品统计结果
     * 
     * 数据来源：
     * - litemall_order: 订单基本信息
     * - litemall_order_goods: 订单商品明细
     */
    @GetMapping("/goods")
    public Object statGoods() {
        return statService.statGoods();
    }
}
```

### StatService.java

```java
/**
 * 统计服务类
 * 
 * 职责：
 * - 实现统计业务逻辑
 * - 调用数据访问层执行统计查询
     * - 将数据库结果转换为前端需要的格式
 * 
 * 设计特点：
 * - 每个统计方法对应一个统计维度
 * - 使用StatVo统一返回格式
 * - 隐藏复杂的SQL查询细节
 */
@Service
public class StatService {
    
    /**
     * 统计数据访问对象
     * 通过XML配置执行统计SQL
     */
    @Autowired
    private StatMapper statMapper;
    
    /**
     * 用户统计业务逻辑
     * 
     * 处理流程：
     * 1. 调用Mapper执行用户统计SQL
     * 2. 将结果转换为StatVo格式
     * 3. 返回标准化统计结果
     * 
     * @return 用户统计视图对象
     * 
     * SQL逻辑：
     * SELECT DATE(add_time) AS day, COUNT(*) AS users
     * FROM litemall_user
     * GROUP BY DATE(add_time)
     * ORDER BY day DESC
     */
    public Object statUser() {
        // 执行用户统计查询
        List<Map> statData = statMapper.statUser();
        
        // 构建统计视图对象
        StatVo statVo = new StatVo();
        statVo.setColumns(new String[]{"day", "users"});
        statVo.setRows(new ArrayList<>());
        
        // 转换数据格式
        for (Map<String, Object> row : statData) {
            Map<String, Object> formattedRow = new HashMap<>();
            formattedRow.put("day", row.get("day"));
            formattedRow.put("users", row.get("users"));
            statVo.add(formattedRow);
        }
        
        return ResponseUtil.ok(statVo);
    }
    
    /**
     * 订单统计业务逻辑
     * 
     * 处理流程：
     * 1. 调用Mapper执行订单统计SQL
     * 2. 计算客单价等衍生指标
     * 3. 将结果转换为StatVo格式
     * 
     * @return 订单统计视图对象
     * 
     * SQL逻辑：
     * SELECT DATE(add_time) AS day, 
     *        COUNT(*) AS orders, 
     *        COUNT(DISTINCT user_id) AS customers, 
     *        SUM(actual_price) AS amount, 
     *        CASE WHEN COUNT(DISTINCT user_id) > 0 
     *             THEN SUM(actual_price) / COUNT(DISTINCT user_id) 
     *             ELSE 0 END AS pcr
     * FROM litemall_order
     * WHERE order_status IN (401, 402)
     * GROUP BY DATE(add_time)
     * ORDER BY day DESC
     */
    public Object statOrder() {
        List<Map> statData = statMapper.statOrder();
        
        StatVo statVo = new StatVo();
        statVo.setColumns(new String[]{"day", "orders", "customers", "amount", "pcr"});
        statVo.setRows(new ArrayList<>());
        
        for (Map<String, Object> row : statData) {
            Map<String, Object> formattedRow = new HashMap<>();
            formattedRow.put("day", row.get("day"));
            formattedRow.put("orders", row.get("orders"));
            formattedRow.put("customers", row.get("customers"));
            formattedRow.put("amount", row.get("amount"));
            formattedRow.put("pcr", row.get("pcr"));
            statVo.add(formattedRow);
        }
        
        return ResponseUtil.ok(statVo);
    }
    
    /**
     * 商品统计业务逻辑
     * 
     * 处理流程：
     * 1. 调用Mapper执行商品统计SQL
     * 2. 关联订单和订单商品表
     * 3. 将结果转换为StatVo格式
     * 
     * @return 商品统计视图对象
     * 
     * SQL逻辑：
     * SELECT DATE(o.add_time) AS day, 
     *        COUNT(*) AS orders, 
     *        SUM(og.number) AS products, 
     *        SUM(og.price * og.number) AS amount
     * FROM litemall_order o
     * JOIN litemall_order_goods og ON o.id = og.order_id
     * WHERE o.order_status IN (401, 402)
     * GROUP BY DATE(o.add_time)
     * ORDER BY day DESC
     */
    public Object statGoods() {
        List<Map> statData = statMapper.statGoods();
        
        StatVo statVo = new StatVo();
        statVo.setColumns(new String[]{"day", "orders", "products", "amount"});
        statVo.setRows(new ArrayList<>());
        
        for (Map<String, Object> row : statData) {
            Map<String, Object> formattedRow = new HashMap<>();
            formattedRow.put("day", row.get("day"));
            formattedRow.put("orders", row.get("orders"));
            formattedRow.put("products", row.get("products"));
            formattedRow.put("amount", row.get("amount"));
            statVo.add(formattedRow);
        }
        
        return ResponseUtil.ok(statVo);
    }
}
```

### StatVo.java

```java
/**
 * 统计视图对象
 * 
 * 设计目的：
 * - 统一统计结果的返回格式
 * - 支持动态列和数据行
 * - 便于前端表格组件展示
 * 
     * 数据结构：
 * - columns: 列名数组，定义统计维度
 * - rows: 数据行列表，每行对应一个统计单元
 * 
 * 使用场景：
 * - 各种统计查询的结果封装
 * - 前端表格数据的标准化格式
 * - 便于扩展新的统计维度
 */
public class StatVo {
    
    /**
     * 统计列名数组
     * 定义统计结果的列名称和顺序
     * 
     * 示例：
     * ["day", "users", "orders"]
     * 
     * 说明：
     * - 第一个列通常是时间维度（如day）
     * - 后续列是统计指标（如users, orders）
     */
    private String[] columns;
    
    /**
     * 统计数据行列表
     * 每行对应一个统计单元的数据
     * 
     * 数据结构：
     * List<Map<String, Object>>
     * 
     * 示例：
     * [
     *   {"day": "2023-01-01", "users": 10, "orders": 5},
     *   {"day": "2023-01-02", "users": 15, "orders": 8}
     * ]
     */
    private List<Map> rows;
    
    /**
     * 添加数据行
     * 
     * @param row 数据行，Map类型，key为列名，value为数据值
     */
    public void add(Map<String, Object> row) {
        if (rows == null) {
            rows = new ArrayList<>();
        }
        rows.add(row);
    }
    
    // Getter和Setter方法
    // 省略具体实现...
}
```