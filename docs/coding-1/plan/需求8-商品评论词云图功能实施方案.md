# 需求8：商品评论词云图功能实施方案

## 需求描述
实现商品评论词云图功能（前端+后端）：
- 初始列表显示商品ID、商品名称、商品类别、评论数
- 搜索功能：选择商品类别，显示该类别下商品
- 点击商品行，显示该商品的评论词云图

## 现有系统分析

### 数据库结构分析
根据代码库分析，评论相关表结构如下：

**litemall_comment表（评论表）**
```sql
CREATE TABLE `litemall_comment` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `value_id` int(11) NOT NULL DEFAULT '0' COMMENT '如果type=0，则是商品评论；如果是type=1，则是专题评论。',
  `type` tinyint(3) NOT NULL DEFAULT '0' COMMENT '评论类型，如果type=0，则是商品评论；如果是type=1，则是专题评论；',
  `content` varchar(1023) DEFAULT '' COMMENT '评论内容',
  `admin_content` varchar(511) DEFAULT '' COMMENT '管理员回复内容',
  `user_id` int(11) NOT NULL DEFAULT '0' COMMENT '用户表的用户ID',
  `has_picture` tinyint(1) DEFAULT '0' COMMENT '是否含有图片',
  `pic_urls` varchar(1023) DEFAULT NULL COMMENT '图片地址列表，采用JSON数组格式',
  `star` smallint(6) DEFAULT '1' COMMENT '评分， 1-5',
  `add_time` datetime DEFAULT NULL COMMENT '创建时间',
  `update_time` datetime DEFAULT NULL COMMENT '更新时间',
  `deleted` tinyint(1) DEFAULT '0' COMMENT '逻辑删除',
  PRIMARY KEY (`id`),
  KEY `id_value` (`value_id`)
) ENGINE=InnoDB AUTO_INCREMENT=1012 DEFAULT CHARSET=utf8mb4 COMMENT='评论表';
```

**litemall_goods表（商品表）**
```sql
CREATE TABLE `litemall_goods` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `goods_sn` varchar(63) NOT NULL DEFAULT '' COMMENT '商品编号',
  `name` varchar(127) NOT NULL DEFAULT '' COMMENT '商品名称',
  `category_id` int(11) DEFAULT '0' COMMENT '商品所属类目ID',
  `brand_id` int(11) DEFAULT '0',
  -- 其他字段省略
  PRIMARY KEY (`id`),
  KEY `goods_sn` (`goods_sn`),
  KEY `cat_id` (`category_id`)
) ENGINE=InnoDB AUTO_INCREMENT=1181004 DEFAULT CHARSET=utf8mb4 COMMENT='商品基本信息表';
```

### 现有API分析
根据代码库分析，相关API接口：

1. **评论相关API** (`/wx/comment/list`)
   - 支持按商品ID获取评论列表
   - 包含评论内容(content)字段
   - 支持分页查询

2. **统计相关API** (`/admin/stat/*`)
   - 现有用户统计、订单统计、商品统计
   - 使用StatVo统一返回格式
   - 支持图表展示

## 技术方案

### 1. 数据库层实现

#### 创建商品评论统计视图
```sql
-- 商品评论统计视图
CREATE OR REPLACE VIEW goods_comment_statistics AS
SELECT 
    g.id AS goods_id,
    g.name AS goods_name,
    g.category_id,
    c.name AS category_name,
    COUNT(cmt.id) AS comment_count,
    MAX(cmt.add_time) AS latest_comment_time
FROM litemall_goods g
LEFT JOIN litemall_category c ON g.category_id = c.id
LEFT JOIN litemall_comment cmt ON g.id = cmt.value_id AND cmt.type = 0 AND cmt.deleted = 0
WHERE g.deleted = 0
GROUP BY g.id, g.name, g.category_id, c.name;

-- 添加索引优化
CREATE INDEX idx_comment_type_value ON litemall_comment(type, value_id);
```

#### 扩展StatMapper.xml
修改文件：`litemall-admin-api/src/main/resources/org/linlinjava/litemall/admin/mybatis/StatMapper.xml`

```xml
<!-- 商品评论统计列表 -->
<select id="statGoodsComment" resultType="map">
    SELECT 
        g.id AS goods_id,
        g.name AS goods_name,
        c.name AS category_name,
        COUNT(cmt.id) AS comment_count
    FROM litemall_goods g
    LEFT JOIN litemall_category c ON g.category_id = c.id
    LEFT JOIN litemall_comment cmt ON g.id = cmt.value_id AND cmt.type = 0 AND cmt.deleted = 0
    WHERE g.deleted = 0
    <if test="categoryId != null">
        AND g.category_id = #{categoryId}
    </if>
    GROUP BY g.id, g.name, c.name
    HAVING COUNT(cmt.id) > 0
    ORDER BY comment_count DESC
    LIMIT #{offset}, #{limit}
</select>

<!-- 商品评论总数统计 -->
<select id="countGoodsComment" resultType="int">
    SELECT COUNT(DISTINCT g.id)
    FROM litemall_goods g
    LEFT JOIN litemall_comment cmt ON g.id = cmt.value_id AND cmt.type = 0 AND cmt.deleted = 0
    WHERE g.deleted = 0 AND cmt.id IS NOT NULL
    <if test="categoryId != null">
        AND g.category_id = #{categoryId}
    </if>
</select>

<!-- 获取商品评论内容（用于词云） -->
<select id="getGoodsComments" resultType="map">
    SELECT content
    FROM litemall_comment
    WHERE value_id = #{goodsId} AND type = 0 AND deleted = 0
    ORDER BY add_time DESC
</select>
```

### 2. 后端实现

#### 创建词云服务类
创建文件：`litemall-admin-api/src/main/java/org/linlinjava/litemall/admin/service/WordCloudService.java`

```java
@Service
public class WordCloudService {
    
    @Autowired
    private StatMapper statMapper;
    
    /**
     * 获取商品评论词云数据
     */
    public Map<String, Object> generateWordCloud(Integer goodsId) {
        // 获取商品评论内容
        List<Map<String, Object>> comments = statMapper.getGoodsComments(goodsId);
        
        if (comments.isEmpty()) {
            return ResponseUtil.ok(new HashMap<>());
        }
        
        // 文本预处理
        StringBuilder allContent = new StringBuilder();
        for (Map<String, Object> comment : comments) {
            String content = (String) comment.get("content");
            if (content != null && !content.trim().isEmpty()) {
                allContent.append(content).append(" ");
            }
        }
        
        // 分词处理（使用HanLP或jieba分词）
        Map<String, Integer> wordFrequency = analyzeWordFrequency(allContent.toString());
        
        // 转换为前端需要的格式
        List<Map<String, Object>> wordCloudData = new ArrayList<>();
        for (Map.Entry<String, Integer> entry : wordFrequency.entrySet()) {
            Map<String, Object> wordData = new HashMap<>();
            wordData.put("name", entry.getKey());
            wordData.put("value", entry.getValue());
            wordCloudData.add(wordData);
        }
        
        // 按频率排序，取前100个词
        wordCloudData.sort((a, b) -> ((Integer) b.get("value")).compareTo((Integer) a.get("value")));
        if (wordCloudData.size() > 100) {
            wordCloudData = wordCloudData.subList(0, 100);
        }
        
        Map<String, Object> result = new HashMap<>();
        result.put("words", wordCloudData);
        result.put("total", comments.size());
        
        return ResponseUtil.ok(result);
    }
    
    /**
     * 词频分析
     */
    private Map<String, Integer> analyzeWordFrequency(String text) {
        Map<String, Integer> wordFrequency = new HashMap<>();
        
        // 去除标点符号和特殊字符
        text = text.replaceAll("[^\\u4e00-\\u9fa5a-zA-Z0-9]", " ");
        
        // 简单的分词处理（实际项目中建议使用专业的分词库）
        String[] words = text.split("\\s+");
        
        // 停用词过滤
        Set<String> stopWords = getStopWords();
        
        for (String word : words) {
            word = word.trim().toLowerCase();
            if (word.length() >= 2 && !stopWords.contains(word)) {
                wordFrequency.put(word, wordFrequency.getOrDefault(word, 0) + 1);
            }
        }
        
        return wordFrequency;
    }
    
    /**
     * 获取停用词列表
     */
    private Set<String> getStopWords() {
        Set<String> stopWords = new HashSet<>();
        stopWords.addAll(Arrays.asList(
            "的", "了", "在", "是", "我", "有", "和", "就", "不", "人", "都", "一", "一个", 
            "上", "也", "很", "到", "说", "要", "去", "你", "会", "着", "没有", "看", "好", 
            "自己", "这", "那", "他", "她", "它", "们", "与", "及", "或", "但是", "而", "因为",
            "所以", "如果", "虽然", "the", "a", "an", "and", "or", "but", "in", "on", "at", 
            "to", "for", "of", "with", "by", "is", "are", "was", "were", "be", "been", "being"
        ));
        return stopWords;
    }
}
```

#### 扩展StatService
```java
@Service
public class StatService {
    
    @Autowired
    private StatMapper statMapper;
    
    @Autowired
    private WordCloudService wordCloudService;
    
    /**
     * 商品评论统计列表
     */
    public Object statGoodsComment(Integer categoryId, Integer page, Integer limit) {
        // 参数校验
        if (page == null || page < 1) {
            page = 1;
        }
        if (limit == null || limit < 1 || limit > 100) {
            limit = 20;
        }
        
        // 计算分页
        int offset = (page - 1) * limit;
        
        // 查询数据
        Map<String, Object> params = new HashMap<>();
        params.put("categoryId", categoryId);
        params.put("offset", offset);
        params.put("limit", limit);
        
        List<Map<String, Object>> list = statMapper.statGoodsComment(params);
        
        // 查询总数（用于分页）
        int total = statMapper.countGoodsComment(params);
        
        // 构建返回结果
        Map<String, Object> result = new HashMap<>();
        result.put("list", list);
        result.put("total", total);
        result.put("page", page);
        result.put("limit", limit);
        result.put("pages", (int) Math.ceil((double) total / limit));
        
        return ResponseUtil.ok(result);
    }
    
    /**
     * 获取商品评论词云数据
     */
    public Object getGoodsWordCloud(Integer goodsId) {
        if (goodsId == null) {
            return ResponseUtil.badArgument();
        }
        
        return wordCloudService.generateWordCloud(goodsId);
    }
}
```

#### 扩展AdminStatController
```java
@RestController
@RequestMapping("/admin/stat")
@Validated
public class AdminStatController {
    
    @Autowired
    private StatService statService;
    
    /**
     * 商品评论统计列表
     */
    @GetMapping("/goods/comment")
    public Object statGoodsComment(
            @RequestParam(required = false) Integer categoryId,
            @RequestParam(defaultValue = "1") Integer page,
            @RequestParam(defaultValue = "20") Integer limit) {
        
        return statService.statGoodsComment(categoryId, page, limit);
    }
    
    /**
     * 获取商品评论词云数据
     */
    @GetMapping("/goods/wordcloud/{goodsId}")
    public Object getGoodsWordCloud(@PathVariable Integer goodsId) {
        return statService.getGoodsWordCloud(goodsId);
    }
}
```

### 3. 前端实现

#### 创建商品评论词云页面
创建文件：`litemall-admin/src/views/stat/goodsComment.vue`

```vue
<template>
  <div class="app-container">
    <div class="filter-container">
      <el-select v-model="listQuery.categoryId" placeholder="选择商品类别" clearable style="width: 200px" class="filter-item">
        <el-option v-for="item in categoryOptions" :key="item.id" :label="item.name" :value="item.id" />
      </el-select>
      <el-button v-waves class="filter-item" type="primary" icon="el-icon-search" @click="handleFilter">
        搜索
      </el-button>
    </div>

    <el-table
      :key="tableKey"
      v-loading="listLoading"
      :data="list"
      border
      fit
      highlight-current-row
      style="width: 100%;"
      @row-click="handleRowClick">
      
      <el-table-column label="商品ID" prop="goods_id" align="center" width="80">
        <template slot-scope="scope">
          <span>{{ scope.row.goods_id }}</span>
        </template>
      </el-table-column>
      
      <el-table-column label="商品名称" prop="goods_name" min-width="150px">
        <template slot-scope="scope">
          <span class="link-type">{{ scope.row.goods_name }}</span>
        </template>
      </el-table-column>
      
      <el-table-column label="商品类别" prop="category_name" width="120px" align="center">
        <template slot-scope="scope">
          <span>{{ scope.row.category_name || '-' }}</span>
        </template>
      </el-table-column>
      
      <el-table-column label="评论数" prop="comment_count" width="100px" align="center">
        <template slot-scope="scope">
          <el-tag type="info">{{ scope.row.comment_count }}</el-tag>
        </template>
      </el-table-column>
      
    </el-table>

    <pagination v-show="total>0" :total="total" :page.sync="listQuery.page" :limit.sync="listQuery.limit" @pagination="getList" />

    <!-- 词云图对话框 -->
    <el-dialog 
      :title="'商品评论词云图 - ' + currentGoodsName" 
      :visible.sync="wordcloudDialogVisible"
      width="80%"
      top="5vh">
      <div class="wordcloud-container">
        <word-cloud 
          v-if="wordcloudData.length > 0"
          :data="wordcloudData"
          :width="800"
          :height="500"
          nameKey="name"
          valueKey="value">
        </word-cloud>
        <div v-else class="no-data">
          <i class="el-icon-document-delete" style="font-size: 48px; color: #909399;"></i>
          <p>暂无评论数据</p>
        </div>
      </div>
      <div slot="footer" class="dialog-footer">
        <el-button @click="wordcloudDialogVisible = false">关闭</el-button>
        <el-button type="primary" @click="exportWordCloud">导出词云图</el-button>
      </div>
    </el-dialog>

  </div>
</template>

<script>
import { statGoodsComment, statGoodsCategories, getGoodsWordCloud } from '@/api/stat'
import waves from '@/directive/waves'
import Pagination from '@/components/Pagination'
import WordCloud from '@/components/WordCloud'

export default {
  name: 'GoodsCommentStat',
  components: { Pagination, WordCloud },
  directives: { waves },
  data() {
    return {
      tableKey: 0,
      list: null,
      total: 0,
      listLoading: true,
      listQuery: {
        page: 1,
        limit: 20,
        categoryId: undefined
      },
      categoryOptions: [],
      wordcloudDialogVisible: false,
      wordcloudData: [],
      currentGoodsId: null,
      currentGoodsName: ''
    }
  },
  created() {
    this.getList()
    this.getCategories()
  },
  methods: {
    getList() {
      this.listLoading = true
      statGoodsComment(this.listQuery).then(response => {
        this.list = response.data.data.list
        this.total = response.data.data.total
        this.listLoading = false
      }).catch(() => {
        this.listLoading = false
      })
    },
    getCategories() {
      statGoodsCategories().then(response => {
        this.categoryOptions = response.data.data
      })
    },
    handleFilter() {
      this.listQuery.page = 1
      this.getList()
    },
    handleRowClick(row, column, event) {
      this.currentGoodsId = row.goods_id
      this.currentGoodsName = row.goods_name
      this.loadWordCloud()
    },
    loadWordCloud() {
      if (!this.currentGoodsId) return
      
      getGoodsWordCloud(this.currentGoodsId).then(response => {
        this.wordcloudData = response.data.data.words || []
        this.wordcloudDialogVisible = true
      }).catch(error => {
        this.$message.error('加载词云数据失败')
      })
    },
    exportWordCloud() {
      // 导出词云图功能
      this.$message.success('词云图导出功能开发中...')
    }
  }
}
</script>

<style scoped>
.wordcloud-container {
  text-align: center;
  padding: 20px;
}

.no-data {
  text-align: center;
  padding: 50px;
  color: #909399;
}

.link-type {
  color: #1890ff;
  cursor: pointer;
}

.link-type:hover {
  color: #40a9ff;
}
</style>
```

#### 创建词云组件
创建文件：`litemall-admin/src/components/WordCloud/index.vue`

```vue
<template>
  <div ref="wordcloud" class="wordcloud-chart"></div>
</template>

<script>
import * as echarts from 'echarts'
import 'echarts-wordcloud'

export default {
  name: 'WordCloud',
  props: {
    data: {
      type: Array,
      required: true
    },
    width: {
      type: Number,
      default: 800
    },
    height: {
      type: Number,
      default: 500
    },
    nameKey: {
      type: String,
      default: 'name'
    },
    valueKey: {
      type: String,
      default: 'value'
    }
  },
  data() {
    return {
      chart: null
    }
  },
  watch: {
    data: {
      deep: true,
      handler() {
        this.updateChart()
      }
    }
  },
  mounted() {
    this.initChart()
    this.updateChart()
  },
  beforeDestroy() {
    if (this.chart) {
      this.chart.dispose()
      this.chart = null
    }
  },
  methods: {
    initChart() {
      this.chart = echarts.init(this.$refs.wordcloud)
      
      // 设置图表大小
      this.$refs.wordcloud.style.width = this.width + 'px'
      this.$refs.wordcloud.style.height = this.height + 'px'
      
      // 响应式处理
      window.addEventListener('resize', this.handleResize)
    },
    updateChart() {
      if (!this.chart || !this.data || this.data.length === 0) {
        return
      }
      
      const option = {
        tooltip: {
          show: true,
          formatter: function(params) {
            return `${params.name}: ${params.value}`
          }
        },
        series: [{
          type: 'wordCloud',
          shape: 'circle',
          left: 'center',
          top: 'center',
          width: '90%',
          height: '90%',
          right: null,
          bottom: null,
          sizeRange: [12, 60],
          rotationRange: [-45, 45],
          rotationStep: 45,
          gridSize: 8,
          drawOutOfBound: false,
          textStyle: {
            normal: {
              fontFamily: 'sans-serif',
              fontWeight: 'bold',
              color: function() {
                // 随机颜色
                const colors = [
                  '#5470c6', '#91cc75', '#fac858', '#ee6666', '#73c0de',
                  '#3ba272', '#fc8452', '#9a60b4', '#ea7ccc', '#ff9f7f'
                ]
                return colors[Math.floor(Math.random() * colors.length)]
              }
            },
            emphasis: {
              shadowBlur: 10,
              shadowColor: '#333'
            }
          },
          data: this.data.map(item => ({
            name: item[this.nameKey],
            value: item[this.valueKey]
          }))
        }]
      }
      
      this.chart.setOption(option)
    },
    handleResize() {
      if (this.chart) {
        this.chart.resize()
      }
    },
    // 导出图片
    exportImage() {
      if (this.chart) {
        const url = this.chart.getDataURL({
          pixelRatio: 2,
          backgroundColor: '#fff'
        })
        
        // 创建下载链接
        const link = document.createElement('a')
        link.download = `wordcloud_${Date.now()}.png`
        link.href = url
        link.click()
      }
    }
  }
}
</script>

<style scoped>
.wordcloud-chart {
  margin: 0 auto;
}
</style>
```

#### 扩展API接口
修改文件：`litemall-admin/src/api/stat.js`

```javascript
// 商品评论统计列表
export function statGoodsComment(query) {
  return request({
    url: '/stat/goods/comment',
    method: 'get',
    params: query
  })
}

// 获取商品评论词云数据
export function getGoodsWordCloud(goodsId) {
  return request({
    url: `/stat/goods/wordcloud/${goodsId}`,
    method: 'get'
  })
}
```

#### 添加路由配置
修改文件：`litemall-admin/src/router/index.js`

```javascript
{
  path: '/stat/goodsComment',
  component: Layout,
  redirect: '/stat/goodsComment',
  name: 'goodsCommentStat',
  meta: {
    title: '商品评论词云',
    icon: 'cloud'
  },
  children: [
    {
      path: 'list',
      name: 'goodsCommentList',
      component: () => import('@/views/stat/goodsComment'),
      meta: { title: '商品评论词云', icon: 'wordcloud' }
    }
  ]
}
```

### 4. 词云算法优化

#### 高级分词处理
创建文件：`litemall-admin-api/src/main/java/org/linlinjava/litemall/admin/service/AdvancedWordCloudService.java`

```java
@Service
public class AdvancedWordCloudService {
    
    /**
     * 高级词频分析（支持中文分词）
     */
    public Map<String, Integer> advancedWordFrequency(String text) {
        Map<String, Integer> wordFrequency = new HashMap<>();
        
        if (text == null || text.trim().isEmpty()) {
            return wordFrequency;
        }
        
        // 1. 文本预处理
        text = preprocessText(text);
        
        // 2. 中文分词（使用简单的字典分词）
        List<String> words = segmentChinese(text);
        
        // 3. 词性过滤和停用词过滤
        Set<String> stopWords = getAdvancedStopWords();
        Set<String> allowedPos = getAllowedPosTags();
        
        for (String word : words) {
            word = word.trim().toLowerCase();
            if (word.length() >= 2 && !stopWords.contains(word)) {
                wordFrequency.put(word, wordFrequency.getOrDefault(word, 0) + 1);
            }
        }
        
        // 4. 词频过滤（去除低频词）
        return filterLowFrequencyWords(wordFrequency, 2);
    }
    
    /**
     * 文本预处理
     */
    private String preprocessText(String text) {
        // 去除HTML标签
        text = text.replaceAll("<[^>]*>", " ");
        
        // 去除URL
        text = text.replaceAll("http[s]?://(?:[a-zA-Z]|[0-9]|[$-_@.&+]|[!*\\(\\),]|(?:%[0-9a-fA-F][0-9a-fA-F]))+", " ");
        
        // 去除特殊字符，保留中文、英文、数字
        text = text.replaceAll("[^\\u4e00-\\u9fa5a-zA-Z0-9\\s]", " ");
        
        // 去除多余空格
        text = text.replaceAll("\\s+", " ").trim();
        
        return text;
    }
    
    /**
     * 中文分词（简化版）
     */
    private List<String> segmentChinese(String text) {
        List<String> words = new ArrayList<>();
        
        // 简单的字典分词
        Set<String> dict = loadDictionary();
        
        // 正向最大匹配
        int maxLen = 5; // 最大词长
        int i = 0;
        while (i < text.length()) {
            boolean found = false;
            for (int len = Math.min(maxLen, text.length() - i); len > 0; len--) {
                String word = text.substring(i, i + len);
                if (dict.contains(word) || (len == 1 && isChineseChar(word.charAt(0)))) {
                    words.add(word);
                    i += len;
                    found = true;
                    break;
                }
            }
            if (!found) {
                i++;
            }
        }
        
        return words;
    }
    
    /**
     * 加载词典（简化版）
     */
    private Set<String> loadDictionary() {
        Set<String> dict = new HashSet<>();
        
        // 常用商品评价词汇
        dict.addAll(Arrays.asList(
            "质量", "不错", "很好", "满意", "喜欢", "漂亮", "好看", "实用", "便宜", "值得",
            "推荐", "购买", "下次", "还会", "发货", "快递", "包装", "收到", "速度", "服务",
            "客服", "态度", "问题", "解决", "售后", "体验", "感觉", "效果", "使用", "方便",
            "简单", "操作", "功能", "齐全", "性能", "稳定", "耐用", "材质", "做工", "精细",
            "颜色", "尺寸", "大小", "合适", "正好", "标准", "描述", "一致", "相符", "图片"
        ));
        
        return dict;
    }
    
    /**
     * 判断是否为中文字符
     */
    private boolean isChineseChar(char c) {
        return c >= 0x4E00 && c <= 0x9FA5;
    }
    
    /**
     * 高级停用词列表
     */
    private Set<String> getAdvancedStopWords() {
        Set<String> stopWords = new HashSet<>();
        
        // 基础停用词
        stopWords.addAll(Arrays.asList(
            "的", "了", "在", "是", "我", "有", "和", "就", "不", "人", "都", "一", "一个", 
            "上", "也", "很", "到", "说", "要", "去", "你", "会", "着", "没有", "看", "好", 
            "自己", "这", "那", "他", "她", "它", "们", "与", "及", "或", "但是", "而", "因为",
            "所以", "如果", "虽然", "the", "a", "an", "and", "or", "but", "in", "on", "at", 
            "to", "for", "of", "with", "by", "is", "are", "was", "were", "be", "been", "being"
        ));
        
        // 电商领域停用词
        stopWords.addAll(Arrays.asList(
            "宝贝", "店家", "老板", "亲", "您好", "谢谢", "感谢", "支持", "光临", "惠顾",
            "评价", "好评", "差评", "中评", "晒图", "追评", "五星", "一星", "评分", "打分"
        ));
        
        return stopWords;
    }
    
    /**
     * 允许的词性标签
     */
    private Set<String> getAllowedPosTags() {
        Set<String> allowedPos = new HashSet<>();
        allowedPos.addAll(Arrays.asList("n", "v", "a", "ad")); // 名词、动词、形容词、副词
        return allowedPos;
    }
    
    /**
     * 过滤低频词
     */
    private Map<String, Integer> filterLowFrequencyWords(Map<String, Integer> wordFrequency, int minFrequency) {
        return wordFrequency.entrySet().stream()
            .filter(entry -> entry.getValue() >= minFrequency)
            .collect(Collectors.toMap(Map.Entry::getKey, Map.Entry::getValue));
    }
}
```

## 测试方案
仅功能测试即可

### 功能测试
1. **列表显示测试**
   - 验证商品ID、名称、类别正确显示
   - 验证评论数统计准确
   - 验证只显示有评论的商品

2. **搜索功能测试**
   - 测试按类别筛选功能
   - 验证类别下拉框数据正确性
   - 验证搜索后分页功能正常

3. **词云图功能测试**
   - 验证点击商品行弹出词云图
   - 验证词云图数据正确性
   - 验证词云图显示效果


## 风险评估与应对

### 技术风险

1. **词云显示**：词语重叠或显示不全
   - 应对：调整ECharts参数，优化布局算法
