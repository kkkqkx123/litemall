# 测试数据建议

## 当前状态分析

目前验证中发现的主要问题是评分统计数据均为0，这是因为测试数据库中缺乏评论数据。以下是添加测试数据的建议。

## 评论数据添加脚本

### 1. 添加测试评论数据

```sql
-- 为热门商品添加测试评论数据
INSERT INTO litemall_comment (id, value_id, type, content, admin_content, user_id, has_picture, pic_urls, star, add_time, update_time, deleted) VALUES
-- 为商品ID 1181000 添加评论
(1, 1181000, 0, '质量很好，很喜欢这个商品，推荐购买！', NULL, 1, 0, '[]', 5, NOW(), NOW(), 0),
(2, 1181000, 0, '商品包装很精美，质量也不错，很满意。', NULL, 2, 0, '[]', 4, NOW(), NOW(), 0),
(3, 1181000, 0, '性价比很高，物超所值，会回购的。', NULL, 3, 0, '[]', 5, NOW(), NOW(), 0),

-- 为商品ID 1006002 添加评论
(4, 1006002, 0, '外观设计很漂亮，材质也很好。', NULL, 4, 0, '[]', 4, NOW(), NOW(), 0),
(5, 1006002, 0, '使用体验很棒，推荐给大家。', NULL, 5, 0, '[]', 5, NOW(), NOW(), 0),
(6, 1006002, 0, '质量超出预期，很满意这次购物。', NULL, 6, 0, '[]', 5, NOW(), NOW(), 0),

-- 为商品ID 1155015 添加评论
(7, 1155015, 0, '绿豆糕口感很好，甜度适中。', NULL, 7, 0, '[]', 4, NOW(), NOW(), 0),
(8, 1155015, 0, '传统味道，很不错的小吃。', NULL, 8, 0, '[]', 4, NOW(), NOW(), 0),
(9, 1155015, 0, '包装精美，送礼很合适。', NULL, 9, 0, '[]', 3, NOW(), NOW(), 0);
```

### 2. 验证评论数据

```bash
-- 验证评论数据是否正确插入
docker exec mysql mysql -uroot -proot litemall -e "SELECT value_id, content, star, add_time FROM litemall_comment WHERE type = 0 AND deleted = 0 LIMIT 10;"
```

## 重新验证接口

### 商品评分统计接口
```bash
curl -X GET "http://localhost:8080/admin/stat/goods/rating" -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

期望看到类似响应：
```json
{
  "errno": 0,
  "data": {
    "total": 9,
    "items": [
      {
        "goods_name": "魔兽世界 奥格瑞玛 勇士软毛家居拖鞋",
        "category_name": "魔兽世界",
        "avg_rating": 4.67,
        "goods_id": 1181000,
        "rating_count": 3
      }
    ]
  },
  "errmsg": "成功"
}
```

### 商品评论词云接口
```bash
curl -X GET "http://localhost:8080/admin/stat/goods/wordcloud" -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

期望看到更多样化的关键词：
```json
{
  "errno": 0,
  "data": [
    {"name": "质量", "value": 8},
    {"name": "很好", "value": 7},
    {"name": "包装", "value": 4},
    {"name": "口感", "value": 3},
    {"name": "性价比", "value": 3},
    {"name": "外观", "value": 3}
  ],
  "errmsg": "成功"
}
```

## 性能测试建议

### 1. 大数据量测试
```sql
-- 为测试性能，可以为更多商品添加评论
-- 使用循环生成更多测试数据（需要存储过程或脚本）
```

### 2. 并发测试
```bash
# 使用ab或wrk进行并发测试
ab -n 100 -c 10 -H "Authorization: Bearer YOUR_JWT_TOKEN" http://localhost:8080/admin/stat/goods/rating
```

## 前端页面验证

### 商品评分统计页面
- 访问：http://localhost:9527/#/stat/goods-rating
- 验证：显示正确的平均评分和评分数量
- 验证：分类筛选功能正常工作

### 商品评论词云页面
- 访问：http://localhost:9527/#/stat/comment
- 验证：词云图正确显示关键词
- 验证：关键词大小反映词频权重

## 监控建议

### 1. 添加接口性能监控
```javascript
// 在AdminStatController中添加性能日志
long startTime = System.currentTimeMillis();
// ... 业务逻辑
long endTime = System.currentTimeMillis();
log.info("商品评分统计接口耗时：{} ms", (endTime - startTime));
```

### 2. 数据库查询优化
```sql
-- 确保相关索引已创建
SHOW INDEX FROM litemall_comment;
SHOW INDEX FROM litemall_goods;
```

## 清理测试数据

```sql
-- 清理测试评论数据
DELETE FROM litemall_comment WHERE id BETWEEN 1 AND 100;
```