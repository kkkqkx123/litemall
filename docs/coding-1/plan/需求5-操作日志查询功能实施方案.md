# 需求5：系统管理-操作日志页面按列查询功能实施方案

## 需求描述
针对操作日志页面的表格增加按列查询功能：按操作时间查询、按操作状态查询。

## 技术方案

### 前端实现

1. **搜索表单设计**
   ```javascript
   // 在操作日志列表上方添加搜索表单
   <el-form :inline="true" :model="searchForm" class="demo-form-inline">
     <el-form-item label="操作时间">
       <el-date-picker
         v-model="searchForm.operationTime"
         type="datetimerange"
         range-separator="至"
         start-placeholder="开始时间"
         end-placeholder="结束时间"
         format="yyyy-MM-dd HH:mm:ss"
         value-format="yyyy-MM-dd HH:mm:ss">
       </el-date-picker>
     </el-form-item>
     
     <el-form-item label="操作状态">
       <el-select v-model="searchForm.result" placeholder="选择状态" clearable>
         <el-option label="成功" value="true"></el-option>
         <el-option label="失败" value="false"></el-option>
       </el-select>
     </el-form-item>
     
     <el-form-item>
       <el-button type="primary" @click="handleSearch">查询</el-button>
       <el-button @click="handleReset">重置</el-button>
     </el-form-item>
   </el-form>
   ```

2. **搜索数据处理**
   ```javascript
   data() {
     return {
       searchForm: {
         operationTime: null,
         result: ''
       },
       listQuery: {
         page: 1,
         limit: 20,
         startTime: undefined,
         endTime: undefined,
         result: undefined
       }
     }
   },
   
   methods: {
     handleSearch() {
       // 处理时间范围
       if (this.searchForm.operationTime && this.searchForm.operationTime.length === 2) {
         this.listQuery.startTime = this.searchForm.operationTime[0]
         this.listQuery.endTime = this.searchForm.operationTime[1]
       }
       
       // 处理操作状态
       if (this.searchForm.result !== '') {
         this.listQuery.result = this.searchForm.result === 'true'
       }
       
       this.listQuery.page = 1
       this.getList()
     },
     
     handleReset() {
       this.searchForm = {
         operationTime: null,
         result: ''
       }
       this.listQuery = {
         page: 1,
         limit: 20
       }
       this.getList()
     }
   }
   ```

### 后端实现

1. **Controller层接口修改**
   ```java
   @GetMapping("/list")
   public Object list(@LoginAdmin Integer adminId,
                      @RequestParam(defaultValue = "1") Integer page,
                      @RequestParam(defaultValue = "10") Integer limit,
                      @RequestParam(required = false) @DateTimeFormat(pattern = "yyyy-MM-dd HH:mm:ss") LocalDateTime startTime,
                      @RequestParam(required = false) @DateTimeFormat(pattern = "yyyy-MM-dd HH:mm:ss") LocalDateTime endTime,
                      @RequestParam(required = false) Boolean result,
                      @RequestParam(required = false) String sort,
                      @RequestParam(required = false) String order) {
       
       // 参数验证
       if (adminId == null) {
           return ResponseUtil.unlogin();
       }
       
       // 构建查询条件
       LitemallLogExample example = new LitemallLogExample();
       LitemallLogExample.Criteria criteria = example.createCriteria();
       
       // 时间范围查询
       if (startTime != null && endTime != null) {
           criteria.andAddTimeBetween(startTime, endTime);
       } else if (startTime != null) {
           criteria.andAddTimeGreaterThanOrEqualTo(startTime);
       } else if (endTime != null) {
           criteria.andAddTimeLessThanOrEqualTo(endTime);
       }
       
       // 操作状态查询
       if (result != null) {
           criteria.andResultEqualTo(result);
       }
       
       // 排序处理
       if (!StringUtils.isEmpty(sort) && !StringUtils.isEmpty(order)) {
           example.setOrderByClause(sort + " " + order);
       } else {
           example.setOrderByClause(LitemallLog.Column.addTime.desc());
       }
       
       PageHelper.startPage(page, limit);
       List<LitemallLog> logList = logService.findByExample(example);
       
       return ResponseUtil.okList(logList);
   }
   ```

2. **Service层优化**
   ```java
   public List<LitemallLog> findByExample(LitemallLogExample example) {
       return logMapper.selectByExampleSelective(example);
   }
   ```

3. **Mapper层SQL优化**
   ```xml
   <select id="selectByExampleSelective" resultMap="BaseResultMap" parameterType="org.linlinjava.litemall.db.domain.LitemallLogExample">
     select
     <if test="distinct">
       distinct
     </if>
     <include refid="Base_Column_List" />
     from litemall_log
     <if test="_parameter != null">
       <include refid="Example_Where_Clause" />
     </if>
     <if test="orderByClause != null">
       order by ${orderByClause}
     </if>
   </select>
   ```

## 高级功能

1. **快速时间选择**
   ```javascript
   // 添加快速时间选择按钮
   <el-button-group>
     <el-button size="small" @click="setQuickTime('today')">今天</el-button>
     <el-button size="small" @click="setQuickTime('yesterday')">昨天</el-button>
     <el-button size="small" @click="setQuickTime('week')">本周</el-button>
     <el-button size="small" @click="setQuickTime('month')">本月</el-button>
   </el-button-group>
   ```

2. **导出功能**
   ```javascript
   handleExport() {
     // 根据当前查询条件导出日志
     const params = {
       startTime: this.listQuery.startTime,
       endTime: this.listQuery.endTime,
       result: this.listQuery.result
     }
     exportLog(params).then(response => {
       // 处理文件下载
       downloadFile(response, '操作日志.xlsx')
     })
   }
   ```

## 实施步骤
1. 前端添加搜索表单组件
2. 修改后端API接口，支持时间范围和状态查询
3. 实现搜索参数传递和处理
4. 添加快速时间选择和导出功能（可选）
5. 测试各种查询组合

## 预计工作量
- 前端开发：4-6小时
- 后端开发：3-4小时
- 测试时间：2小时

## 注意事项
- 时间查询要考虑时区问题
- 大数据量查询性能优化
- 添加查询条件验证
- 考虑查询结果的分页处理
- 添加操作日志的查询记录