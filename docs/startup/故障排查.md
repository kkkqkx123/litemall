# Litemall故障排查指南

## 启动失败常见问题

### 1. 数据库连接问题

#### 错误信息：Access denied for user 'root'@'localhost'
**原因**：数据库密码错误
**解决方案**：
```yaml
# 修改配置文件：litemall-db/src/main/resources/application-db.yml
spring:
  datasource:
    username: root
    password: 1234567kk  # 修改为你的MySQL密码
```

#### 错误信息：Communications link failure
**原因**：MySQL服务未启动
**解决方案**：
```bash
# Windows
net start mysql

# Linux
sudo systemctl start mysql

# Mac
brew services start mysql
```

#### 错误信息：Unknown database 'litemall'
**原因**：数据库未创建
**解决方案**：
```sql
CREATE DATABASE IF NOT EXISTS litemall DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### 2. 端口占用问题

#### 检查端口占用
```bash
# Windows
netstat -ano | findstr :8080
tasklist | findstr 进程号

# Linux/Mac
lsof -i :8080
```

#### 修改端口
```bash
# 修改后端端口
java -jar litemall-all/target/litemall-all-0.1.0-exec.jar --server.port=8081

# 修改Vue前端端口
# 编辑 litemall-vue/vue.config.js
module.exports = {
  devServer: {
    port: 9528
  }
}
```

### 3. 构建失败问题

#### Maven构建失败
**错误信息**：Could not resolve dependencies
**解决方案**：
```bash
# 清理本地仓库
cd ~/.m2/repository
rm -rf org/springframework

# 重新构建
cd litemall
mvn clean install -DskipTests
```

#### Node.js构建失败
**错误信息**：npm ERR! code ELIFECYCLE
**解决方案**：
```bash
# 清理node_modules
cd litemall-vue
rm -rf node_modules
rm package-lock.json
npm install
npm run dev
```

### 4. 内存不足问题

#### JVM内存配置
```bash
# 启动时配置内存
java -Xms512m -Xmx1024m -jar litemall-all/target/litemall-all-0.1.0-exec.jar
```

#### Node.js内存配置
```bash
# 增加Node.js内存限制
export NODE_OPTIONS="--max-old-space-size=4096"
npm run dev
```

## 运行时问题

### 1. 服务启动后无法访问

#### 检查服务状态
```bash
# 检查端口监听
netstat -tlnp | grep :8080

# 检查进程
ps aux | grep java

# 查看日志
tail -f logs/spring.log
```

#### 防火墙配置
```bash
# Windows防火墙
netsh advfirewall firewall add rule name="Litemall" dir=in action=allow protocol=TCP localport=8080

# Linux防火墙
sudo ufw allow 8080
sudo firewall-cmd --permanent --add-port=8080/tcp
sudo firewall-cmd --reload
```

### 2. 微信小程序无法连接

#### 检查配置
```javascript
// 检查 litemall-wx/config/api.js
const config = {
  // 确保地址正确
  apiUrl: 'http://localhost:8080/wx/',
  
  // 生产环境
  // apiUrl: 'https://your-domain.com/wx/'
}
```

#### 微信开发者工具配置
1. 设置 -> 项目设置 -> 本地设置
2. 勾选"不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书"

### 3. 图片上传失败

#### 检查文件路径权限
```bash
# 检查上传目录权限
ls -la litemall-all/target/classes/static/
chmod 755 litemall-all/target/classes/static/
```

#### 检查文件大小限制
```yaml
# application.yml
spring:
  servlet:
    multipart:
      max-file-size: 10MB
      max-request-size: 10MB
```

## 性能优化

### 1. 数据库优化
```sql
-- 添加索引
CREATE INDEX idx_goods_category_id ON litemall_goods(category_id);
CREATE INDEX idx_order_user_id ON litemall_order(user_id);

-- 优化查询
EXPLAIN SELECT * FROM litemall_goods WHERE category_id = 1;
```

### 2. JVM优化
```bash
# 生产环境配置
java -server -Xms1024m -Xmx2048m -XX:+UseG1GC -jar litemall-all/target/litemall-all-0.1.0-exec.jar
```

### 3. 缓存配置
```yaml
# application.yml
spring:
  cache:
    type: redis
  redis:
    host: localhost
    port: 6379
    password:
```

## 日志分析

### 1. 日志文件位置
- **后端日志**: `logs/spring.log`
- **Maven日志**: `target/surefire-reports/`
- **Node.js日志**: `litemall-vue/npm-debug.log`

### 2. 常见错误日志

#### 数据库连接超时
```
com.mysql.cj.jdbc.exceptions.CommunicationsException: Communications link failure
```
**解决**: 检查网络连接和MySQL配置

#### 内存溢出
```
java.lang.OutOfMemoryError: Java heap space
```
**解决**: 增加JVM内存配置

#### 端口冲突
```
java.net.BindException: Address already in use: bind
```
**解决**: 修改端口或关闭占用进程

## 调试技巧

### 1. 远程调试
```bash
# 启动调试模式
java -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=5005 -jar litemall-all/target/litemall-all-0.1.0-exec.jar
```

### 2. 日志级别调整
```yaml
# application.yml
logging:
  level:
    org.springframework: DEBUG
    org.mybatis: DEBUG
    com.litemall: DEBUG
```

### 3. 数据库调试
```yaml
# application.yml
mybatis:
  configuration:
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
```

## 联系支持

### 获取帮助
1. 查看日志文件
2. 检查配置文件
3. 搜索已知问题
4. 提交Issue

### 资源链接
- [GitHub Issues](https://github.com/linlinjava/litemall/issues)
- [项目文档](https://linlinjava.gitbook.io/litemall)
- [社区讨论](https://github.com/linlinjava/litemall/discussions)