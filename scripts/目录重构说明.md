# Scripts 目录重构说明

## 重构内容

本次重构将 `scripts` 目录下的文件按功能分类，分别放入 `build` 和 `start` 子目录中：

### 目录结构
```
scripts/
├── README.md              # 主要使用指南
├── build/                  # 构建脚本目录
│   ├── build-all.ps1      # 全量构建脚本 (PowerShell)
│   ├── build-all.sh       # 全量构建脚本 (Bash)
│   ├── build-backend.ps1  # 后端构建脚本 (PowerShell)
│   ├── build-backend.sh   # 后端构建脚本 (Bash)
│   ├── build-vue.ps1      # Vue前端构建脚本 (PowerShell)
│   ├── build-vue.sh       # Vue前端构建脚本 (Bash)
│   ├── build-wx.ps1       # 微信小程序构建脚本 (PowerShell)
│   ├── build-wx.sh        # 微信小程序构建脚本 (Bash)
│   └── build脚本使用说明.md
└── start/                  # 启动脚本目录
    ├── start-web.ps1      # Web服务启动脚本 (PowerShell)
    ├── start-wx.ps1        # 微信小程序启动脚本 (PowerShell)
    └── start脚本使用说明.md
```

### 使用方式变更

所有脚本的使用路径都已更新，需要在原有路径中添加相应的子目录：

#### 构建脚本
- 原路径：`./scripts/build-all.sh`
- 新路径：`./scripts/build/build-all.sh`

#### 启动脚本
- 原路径：`./scripts/start-wx.ps1`
- 新路径：`./scripts/start/start-wx.ps1`

### 路径兼容性

所有脚本都已正确更新，能够自动找到项目根目录和相应的配置文件：

1. **Bash脚本**：使用 `$(dirname "$(dirname "$0")")` 计算项目根目录
2. **PowerShell脚本**：使用 `Split-Path -Parent (Split-Path -Parent $PSScriptRoot)` 计算项目根目录

### 验证的关键路径

✅ `litemall-wx` 目录存在
✅ `litemall-all\target\litemall-all-0.1.0-exec.jar` 文件存在
✅ 所有脚本都能正确计算项目根目录路径
✅ 脚本能够找到相应的配置文件

### 文档更新

`README.md` 文件已更新，包含：
- 新的目录结构图
- 更新的使用示例路径
- 所有脚本调用的路径都已修正

### 特殊修复

修复了 `build-wx.sh` 脚本中的自引用路径问题，现在使用 `$(basename "$0")` 来正确引用自身文件名。

### 1. PowerShell脚本路径计算问题

**问题描述**：所有PowerShell脚本（包括启动脚本和构建脚本）使用单层`Split-Path -Parent $PSScriptRoot`获取项目根目录，导致项目根目录被错误识别为scripts目录。

**影响文件**：
- 启动脚本：`start-wx.ps1`、`start-web.ps1`
- 构建脚本：`build-all.ps1`、`build-backend.ps1`、`build-vue.ps1`、`build-wx.ps1`

**原始代码**：
```powershell
$ProjectRoot = Split-Path -Parent $PSScriptRoot
```

**修复代码**：
```powershell
$ProjectRoot = Split-Path -Parent (Split-Path -Parent $PSScriptRoot)
```

**修复原因**：
- `$PSScriptRoot`指向脚本所在目录（如`D:\项目\Spring\litemall\scripts\build`）
- 单层`Split-Path -Parent`得到的是`D:\项目\Spring\litemall\scripts`
- 双层`Split-Path -Parent`才能得到正确的项目根目录`D:\项目\Spring\litemall`

**验证结果**：✅ 修复后所有构建脚本都能正确找到项目路径和各个模块目录

### 2. Bash构建脚本路径计算问题

**问题描述**：所有Bash构建脚本使用单层`$(dirname "$SCRIPT_DIR")`获取项目根目录，导致项目根目录被错误识别为scripts目录。

**影响文件**：
- 构建脚本：`build-all.sh`、`build-backend.sh`、`build-vue.sh`、`build-wx.sh`

**原始代码**：
```bash
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(dirname "$SCRIPT_DIR")"
```

**修复代码**：
```bash
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(dirname "$(dirname "$SCRIPT_DIR")")"
```

**修复原因**：
- `SCRIPT_DIR`指向脚本所在目录（如`/mnt/d/项目/Spring/litemall/scripts/build`）
- 单层`$(dirname "$SCRIPT_DIR")`得到的是`/mnt/d/项目/Spring/litemall/scripts`
- 双层`$(dirname "$(dirname "$SCRIPT_DIR")")`才能得到正确的项目根目录`/mnt/d/项目/Spring/litemall`

**验证结果**：✅ 修复后所有Bash构建脚本都能正确找到项目路径和各个模块目录

## 使用方法

### 构建项目
```bash
# Linux/macOS
./scripts/build/build-all.sh

# Windows PowerShell
.\scripts\build\build-all.ps1
```

### 启动服务
```powershell
# Windows PowerShell
.\scripts\start\start-wx.ps1
```

所有脚本都能正常工作，无需额外配置。